# 25.05.09(금) TIL

## 오늘 한 내용
__1. Unity 입문 프로젝트 발제 (팀플)__

#### 맡은 부분 : 플레이어별 고유 능력
  - 불  : 1. 불 장애물 통과
         2. (상호작용 가능한 오브젝트 얼음)녹이기
      - 사용할 오브젝트가 얼려있는 경우 - 불로 녹여서 사용
  - 얼음 :  1. 얼음 장애물 통과
             2. (상호작용 가능한 오브젝트)얼리기
      - 사용할 오브젝트를 고정시키고 싶을때 - 얼음으로 얼려서 고정
    <br>
  - 장애물 종류 : 불(불만 통과), 얼음(얼음만 통과), 독(둘 다 통과할 수 없음)
  
  <details>
  <summary>[플로우차트]</summary>
      
    ![image](https://github.com/user-attachments/assets/179eba58-0ed6-4b67-bcd0-4be635674003)
  </details>
    
  <table>
    <thead>
      <tr>
        <th>플레이어</th>
        <th>충돌위치</th>
        <th>결과값</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="4">Fire</td>
        <td>fire</td>
        <td>pass</td>
      </tr>
      <tr>
        <td>ice</td>
        <td rowspan="2">GameOver</td>
      </tr>
      <tr>
        <td>poison</td>
      </tr>
      <tr>
        <td>switch</td>
        <td>Melt</td>
      </tr>
      <tr>
        <td rowspan="4">Ice</td>
        <td>ice</td>
        <td>pass</td>
      </tr>
      <tr>
        <td>fire</td>
        <td rowspan="2">GameOver</td>
      </tr>
      <tr>
        <td>poison</td>
      </tr>
      <tr>
        <td>switch</td>
        <td>Frozen</td>
      </tr>
    </tbody>
  </table>

#### 작성한 코드 <br>
1. Ability.cs
     
      <details>
       <summary>[1. 기본]</summary>
    
          using System;
          using System.Collections;
          using System.Collections.Generic;
          using System.Security.Cryptography;
          using Unity.VisualScripting;
          using UnityEngine;
          using UnityEngine.UIElements;
          
          public enum AbilityType
          {
              FIRE,
              ICE
          }
          
          public class Ability : MonoBehaviour
          {
              private void OnTriggerEnter2D(Collider2D other)
              {
                  Debug.Log("충돌 중");
                  Interact(other.gameObject);
              }
          
              public AbilityType abilityType;
          
              const string fireTag = "Fire Obstacle"; //불 Tag (용암풀)
              const string iceTag = "Ice Obstacle"; //얼음 Tag (얼음풀)
              const string poisonTag = "Poison Obstacle"; //독 Tag
              const string statefulTag = "Stateful Obstacle"; //형태변화가 있는 오브젝트
          
              //public GameObject statefulObstacle;
              //Dictionary<string, Action> tagActions; Dictionary를 쓰고 싶었는데 일단 코드 작성부터 하려고 넘김
          
              public void Interact(GameObject target)
              {
                  string targetTag = target.tag; //부딪힌 상대의 태그 확인
          
                  switch (abilityType)
                  {
                      case AbilityType.FIRE: //플레이어가 FIRE 능력을 가지고 있다면,
          
                          if (targetTag == fireTag) //장애물의 태그가 불일 경우
                          {
                              Debug.Log("불 캐릭터가 불 통과 중");
                          }
                          else if (targetTag == iceTag || targetTag == poisonTag) //장애물의 태그가 얼음일 경우
                          {
                              GameOver();
                          }
                          else if (targetTag == statefulTag)
                          {
                              var csSwitch = target.GetComponent<Switch>(); //타겟(장애물)에 붙어있는 Switch를 찾음
                              if(csSwitch != null)
                              {
                                  //녹임
                                  if (csSwitch.isFrozen)
                                  {
                                      csSwitch.isFrozen = false;
                                  }
                                  else
                                  {
          
                                  }
                              }
                          }
                          break;
          
                      case AbilityType.ICE: //플레이어가 ICE 능력을 가지고 있다면,
          
                          if (targetTag == iceTag) //장애물의 태그가 얼음일 경우
                          {
                              Debug.Log("물 캐릭터가 얼음 통과 중");
                          }
                          else if (targetTag == fireTag || targetTag == poisonTag) //장애물의 태그가 불일 경우
                          {
                              GameOver();
                          }
                          else if (targetTag == statefulTag)
                          {
                              var csSwitch = target.GetComponent<Switch>();
                              if(csSwitch != null)
                              {
                                  //얼림
                                  if(!csSwitch.isFrozen)
                                  {
                                      csSwitch.isFrozen = true;
                                  }
                                  else
                                  {
          
                                  }
                              }
                          }
                          break;
                  }
              }
          
              void GameOver()
              {
                  Debug.Log("게임 오버!");
              }
          }
      </details>
  
      <details>
       <summary>[2. 인터페이스 사용]</summary>

          using System;
          using System.Collections;
          using System.Collections.Generic;
          using System.Security.Cryptography;
          using Unity.VisualScripting;
          using UnityEngine;
          using UnityEngine.UIElements;
          
          
          public interface IAbility
          {
              void Interact(GameObject target);
          }
          
          public class Ability : MonoBehaviour
          {
          /*    private void OnCollisionEnter2D(Collision2D other)
              {
                  Debug.Log("충돌 중");
                  Interact(other.gameObject);
              }*/
          
              public ABILITYTYPE abilityType;
          
              const string fireTag = "Fire Obstacle"; //불 Tag (용암풀)
              const string iceTag = "Ice Obstacle"; //얼음 Tag (얼음풀)
              const string poisonTag = "Poison Obstacle"; //독 Tag
              const string statefulTag = "Stateful Obstacle"; //형태변화가 있는 오브젝트
          
              //public GameObject statefulObstacle;
              //Dictionary<string, Action> tagActions;
          
              public void Interact(GameObject target)
              {
                  string targetTag = target.tag; //부딪힌 상대의 태그 확인
                  switch (abilityType)
                  {
                      case ABILITYTYPE.FIRE: //플레이어가 FIRE 능력을 가지고 있다면,
          
                          if (targetTag == fireTag) //장애물의 태그가 불일 경우
                          {
                              Debug.Log("불 캐릭터가 불 통과 중");
                          }
                          else if (targetTag == iceTag || targetTag == poisonTag) //장애물의 태그가 얼음일 경우
                          {
                              GameOver();
                          }
                          else if (targetTag == statefulTag)
                          {
                              if (target.TryGetComponent<Switch>(out var data)) //타겟(장애물)에 붙어있는 Switch를 찾음
                              {
                                  data.SetFrozen(abilityType == ABILITYTYPE.ICE); //SetFrozen(false)
                              }
                          }
                          break;
          
                      case ABILITYTYPE.ICE: //플레이어가 ICE 능력을 가지고 있다면,
          
                          if (targetTag == iceTag) //장애물의 태그가 얼음일 경우
                          {
                              Debug.Log("물 캐릭터가 얼음 통과 중");
                          }
                          else if (targetTag == fireTag || targetTag == poisonTag) //장애물의 태그가 불일 경우
                          {
                              GameOver();
                          }
                          else if (targetTag == statefulTag)
                          {
                              if (target.TryGetComponent<Switch>(out var data))
                              {
                                  data.SetFrozen(abilityType == ABILITYTYPE.ICE); //SetFrozen(true)
                              }
                          }
                          break;
                  }
              }
          
              void GameOver()
                  Debug.Log("게임 오버!");
              }
          }
      </details>


2. Switch.cs
      <details>
       <summary>[1. 기본]</summary>
          
          using Unity.VisualScripting;
          using UnityEngine;
          
          public class Switch : MonoBehaviour
          {
              [SerializeField] private GameObject ObstacleObj;
              [SerializeField] private Animator animator;
              //[SerializeField] private GameObject IceState; //자식 오브젝트 Ice
          
              //bool값을 이용해 얼음이 있는 지 없는 지 판단
              private bool isFrozen; //얼음 유무 판단
              private bool isState; //상호작용이 가능한 상태인지 확인
              private bool isCollision; //충돌 여부 판단
          
          /*    private void Update()
              {
                  Debug.Log("isState : " + isState);
              }*/
          
              private void OnCollisionStay2D(Collision2D collision)
              {
                  isCollision = true;
                  //Debug.Log("isCollision : " + isCollision);
                  SetState(true);
              }
          
              private void OnCollisionExit2D(Collision2D collision)
              {
                 isCollision= false;
                  if (isFrozen)
                  {
                      return;
                  }
                  SetState(false);
              }
          
              public void SetFrozen(bool isFrozen)
              {
                  bool originValue = this.isFrozen;
                  if (!isCollision) return;
          
                  //Debug.Log("SetFrozen - originValue : " + originValue);
                  this.isFrozen = isFrozen;
                  //Debug.Log("SetFrozen - isFrozen : " + isFrozen);
                  //Debug.Log(isFrozen == originValue ? "같은 타입" : this.isFrozen == true ? "얼림" : "녹임");
              }
          
              private void SetState(bool isState)
              {
                  //if (isState == this.isState) return;
                  this.isState = isState;
                  //Debug.Log(this.isState == true ? "애니메이션 작동" : "애니메이션 미작동");
              }
          }
      </details>

3. BaseController.cs (플레이어 이동)
      <details>
       <summary>[1. 기본]</summary>
        
          if (UnityEngine.Input.GetKeyDown(downKey))
          {
              Debug.DrawRay(transform.position, Vector2.down * 2f, Color.green, 0.5f); //체크
              RaycastHit2D hit = Physics2D.Raycast(transform.position, Vector2.down, 1f, LayerMask.GetMask("Interaction"));
              //Debug.Log("Trigger 감지 설정: " + Physics2D.queriesHitTriggers);
  
              if (hit.collider != null)
              {
                  GameObject hitObj = hit.collider.gameObject;
                  //Debug.Log("충돌체 : " + hit.collider.name);
  
                  IAbility ability = GetComponent<IAbility>();
                  if(ability != null)
                  {
                      gameObject.GetComponent<IAbility>().Interact(hit.collider.gameObject);
                      //ability.Interact(hit.collider.gameObject);
                  }
                  else
                  {
                      Debug.LogWarning("Ability NU11");
                  }
              }
              else { Debug.LogWarning("Raycast NU11"); }
          }
      }
      </details>

: 코드 요약
1. 장애물 오브젝트에 Tag 부여
2. 플레이어와 충돌 판별(키 입력)
3. raycast로 실행
* 레이캐스트 -> 점프 시 감지 방지를 위해 충돌 체크

#### 새로 알게 된 것
raydraw : 
raycast : 

#### 다시 공부한 것
1. colliection : 
  1. dictionary : 
    1. Action : 
  2. list : 
2. rigidbody : 
  1. addforce : 

#### 작성 시 유의해야 할 것
1. 한가지 행동은 한곳에서
   ex) 오브젝트 충돌 후 키 입력을 통해 실행되어야 해서, 오브젝트 판별하는 부분에 키 입력을 받았었다.   
   키 입력은 플레이어 이동 부분과 관련 있으므로 플레이어 스크립트로 넘어감!
